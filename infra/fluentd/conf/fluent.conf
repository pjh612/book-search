<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>


<source>
  @type tail
  path /fluentd/log/app.log
  pos_file /fluentd/log/app.pos
  tag springboot.app
  read_from_head true
  <parse>
    @type json
    time_key @timestamp
    time_type string
    time_format %Y-%m-%dT%H:%M:%S.%N%:z
  </parse>
</source>


<filter springboot.app>
  @type record_transformer
  enable_ruby true
  <record>
    level       ${record["level"]}
    message     ${record["message"]}
    logger      ${record["logger_name"]}
    thread      ${record["thread_name"]}
    stacktrace  ${record["stack_trace"]}
    traceId     ${record["traceId"]}
    spanId      ${record["spanId"]}
    service     ${record["service"]}
    timestamp  ${record["timestamp"]}
  </record>
</filter>


<match springboot.app>
 @type kafka2
  brokers trevari-kafka-1:29092,trevari-kafka-2:29092,trevari-kafka-3:29092
  topic logs-api
  <format>
    @type json
  </format>
#   @type elasticsearch
#   host elasticsearch
#   port 9200
#   logstash_format true
#   logstash_prefix springboot-log
#   include_tag_key true
#   reconnect_on_error true
#   reload_connections false
#   request_timeout 15s
#   template_name springboot-template
#   template_file /fluentd/etc/index-template.json
#   suppress_type_name true
</match>

<match **>
  @type stdout
</match>